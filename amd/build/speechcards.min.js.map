{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","log","Ajax","def","polly","cloudpoodll","debug","init","index","itemdata","quizhelper","init_app","app","passmark","pointer","jsondata","props","glider","dryRun","language","terms","results","controls","i","sentences","length","sentence","init_controls","initComponents","initCards","register_events","the_list","uniqueid","star_rating","next_button","on","stepdata","grade","do_next","click","check","is_end","setTimeout","do_end","theCallback","message","console","type","speechtext","capturedspeech","cleanspeechtext","cleanText","spoken","correct","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","then","Deferred","reject","progress_dots","getScript","done","setPointer","newpointer","thelist","append","replace","glide","autoplay","afterTransition","data","afterInit","phraseheard","currentphrase","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","text","trim","call","stars","code","forEach","star","html","points","result","push","clearStarRating","go","do_prev","color","o"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'core/ajax','mod_poodlltime/definitions','mod_poodlltime/pollyhelper',\n    'mod_poodlltime/cloudpoodllloader'], function($, log,Ajax, def, polly, cloudpoodll) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('Poodll Time Speechcards: initialising');\n\n    return {\n\n        init: function(index, itemdata,quizhelper) {\n\n            this.init_app(index,itemdata,quizhelper);\n        },\n\n        init_app: function(index, itemdata,quizhelper) {\n\n\n            var app = {\n                passmark: 75,\n                pointer: 1,\n                jsondata: null,\n                props: null,\n                glider: null,\n                dryRun: false,\n                language: 'en-US',\n                terms: [],\n                results: [],\n                controls: {},\n\n                init: function() {\n\n                    //init terms\n                    for(var i=0;i<itemdata.sentences.length;i++) {\n                        app.terms[i] = itemdata.sentences[i].sentence;\n                    }\n                    app.language = itemdata.language;\n\n                    this.init_controls();\n                    this.initComponents();\n                    this.initCards();\n                    this.register_events();\n                },\n\n                init_controls: function () {\n                    app.controls= {};\n                    app.controls.the_list = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_speechcards_thelist\");\n                    app.controls.star_rating = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_star_rating\");\n                    app.controls.next_button = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime-speechcards_nextbutton\");\n                }\n                ,\n\n                register_events: function () {\n                    //When click next button , report and leave it up to parent to eal with it.\n                    $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function (e) {\n                        var stepdata = {};\n                        var grade = 50;\n                        stepdata.index = index;\n                        stepdata.grade = grade;\n                        quizhelper.do_next(stepdata);\n                    });\n\n                    app.controls.next_button.click(function() {\n                        //user has given up ,update word as failed\n                        app.check(false);\n\n                        //transition if required\n                        if (app.is_end()) {\n                            setTimeout(function () {\n                                app.do_end();\n                            }, 200);\n                        } else {\n                            setTimeout(function () {\n                                app.do_next();\n                            }, 200);\n                        }\n\n                    });\n                }\n                ,\n\n                initComponents: function() {\n\n                    //The logic here is that on correct we transition.\n                    //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n                    var theCallback = function(message) {\n                        //console.log(\"triggered callback\");\n                        console.log(message);\n\n                        switch (message.type) {\n                            case 'recording':\n\n                                break;\n\n                            case 'speech':\n                                var speechtext = message.capturedspeech;\n                                var cleanspeechtext = app.cleanText(speechtext);\n\n                                var spoken = cleanspeechtext;\n                                var correct = app.terms[app.pointer - 1];\n\n                                //Similarity check by character matching\n                                var similarity = app.similarity(spoken,correct);\n                                log.debug('JS similarity: ' + spoken + ':' + correct +':' + similarity);\n\n                                //Similarity check by direct-match/acceptable-mistranscription\n                                if (similarity >= app.passmark ||\n                                    app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1]) ) {\n                                    log.debug('local match:' + ':' + spoken +':' + correct);\n                                    app.showStarRating(100);\n                                    app.flagCorrectAndTransition(app.terms[app.pointer - 1]);\n                                    return;\n                                }\n\n                                //Similarity check by phonetics(ajax)\n                                app.checkByPhonetic(spoken,correct).then(function(similarity) {\n                                    if (similarity===false) {\n                                        return $.Deferred().reject();\n                                    }else{\n                                        log.debug('PHP similarity: ' + spoken + ':' + correct +':' + similarity);\n                                        app.showStarRating(similarity);\n                                        if(similarity>=app.passmark) {\n                                            app.flagCorrectAndTransition(similarity, app.terms[app.pointer - 1]);\n                                        }\n                                    }//end of if check_by_phonetic result\n                                });//end of check by phonetic\n\n                        }//end of switch message type\n                    };\n\n                    //init cloudpoodll push recorder\n                    cloudpoodll.init('poodlltime-poodllrecorder', theCallback);\n\n                    //init progress dots\n                    app.progress_dots(app.results,app.terms);\n\n\n                },\n\n                initCards: function () {\n                    $.getScript('https://cdn.jsdelivr.net/npm/glidejs@2.1.0/dist/glide.min.js').done(function () {\n\n                        function setPointer(newpointer) {\n                            app.pointer = newpointer;\n                        }\n\n                        //add speechcards\n                        var li_template = \"<li class='glide__slide'><div class='poodlltime-poodllspeechcards_box'>@thetext@</div></li>\";\n                        var thelist = app.controls.the_list;\n                        for(var i=0; i< app.terms.length; i++) {\n                            thelist.append(li_template.replace('@thetext@', app.terms[i]));\n                        }\n\n\n                        app.glider = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_speechcards_glide\").glide({\n                            type: \"carousel\",\n                            autoplay: false,\n                            afterTransition: function (data) {\n                                setPointer(data.index);\n                            },\n                            afterInit: function (data) {\n                                setPointer(data.index);\n                            },\n                        }).data('glide_api');\n                    });\n                }\n                ,\n\n                flagCorrectAndTransition: function () {\n\n                    //update students word log if matched\n                    app.check(true);\n\n                    //transition if required\n                    if (app.is_end()) {\n                        setTimeout(function () {\n                            app.do_end();\n                        }, 700);\n                    } else {\n                        setTimeout(function () {\n                            app.do_next();\n                        }, 700);\n                    }\n\n                },\n\n                wordsDoMatch: function(phraseheard, currentphrase) {\n                    //lets lower case everything\n                    phraseheard = app.cleanText(phraseheard);\n                    currentphrase = app.cleanText(currentphrase);\n                    if (phraseheard == currentphrase) {\n                        return true;\n                    }\n                    return false;\n                },\n\n                similarity: function (s1, s2) {\n                    var longer = s1;\n                    var shorter = s2;\n                    if (s1.length < s2.length) {\n                        longer = s2;\n                        shorter = s1;\n                    }\n                    var longerLength = longer.length;\n                    if (longerLength == 0) {\n                        return 1.0;\n                    }\n                    return (longerLength - app.editDistance(longer, shorter)) / parseFloat(longerLength);\n                }\n                ,\n                editDistance: function (s1, s2) {\n                    s1 = s1.toLowerCase();\n                    s2 = s2.toLowerCase();\n\n                    var costs = new Array();\n                    for (var i = 0; i <= s1.length; i++) {\n                        var lastValue = i;\n                        for (var j = 0; j <= s2.length; j++) {\n                            if (i == 0)\n                                costs[j] = j;\n                            else {\n                                if (j > 0) {\n                                    var newValue = costs[j - 1];\n                                    if (s1.charAt(i - 1) != s2.charAt(j - 1))\n                                        newValue = Math.min(Math.min(newValue, lastValue),\n                                            costs[j]) + 1;\n                                    costs[j - 1] = lastValue;\n                                    lastValue = newValue;\n                                }\n                            }\n                        }\n                        if (i > 0)\n                            costs[s2.length] = lastValue;\n                    }\n                    return costs[s2.length];\n                }\n                ,\n\n                cleanText: function (text) {\n                    return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n                }\n                ,\n\n                //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n                checkByPhonetic: function (spoken, correct) {\n\n                    return Ajax.call([{\n                        'methodname': 'mod_poodlltime_check_by_phonetic',\n                        'args': {\n                            'spoken': spoken,\n                            'correct': correct,\n                            'language': app.language,\n                        }\n                    }])[0];\n\n                },\n\n                showStarRating: function(similarity){\n                    //how many stars code\n                    var stars = [true,true,true];\n                    if(similarity<1){\n                        stars=[true,true,false];\n                    }\n                    if(similarity<app.passmark){\n                        stars=[true,false,false];\n                    }\n                    if(similarity<0.5){\n                        stars=[false,false,false];\n                    }\n                    console.log(stars,similarity);\n\n                    //prepare stars html\n                    var code=\"\";\n                    stars.forEach(function(star){\n                        if(star===true){\n                            code+='<i class=\"fa fa-star\"></i>';\n                        }\n                        else{\n                            code+='<i class=\"fa fa-star-o\"></i>';\n                        }\n                    });\n                    console.log(code);\n                    app.controls.star_rating.html(code);\n                },\n\n                check: function (correct) {\n                    var points = 1;\n                    if (correct == true) {\n                        points = 1;\n                    } else {\n                        points = 0;\n                    }\n                   // $(\".a4e-distractor\").css('pointer-events', 'none');\n                    var result = {\n                        points: points\n                    };\n                    //finally add our result to the results\n                    app.results.push(result);\n\n                },\n\n                do_next: function () {\n                    app.progress_dots(app.results, app.terms);\n                    app.clearStarRating();\n                    if (!app.is_end()) {\n                        app.glider.go('>');\n                    } else {\n                        app.do_end();\n                    }\n                }\n                ,\n                do_prev: function () {\n                    app.glider.go('<');\n                }\n                ,\n\n                clearStarRating: function () {\n                    app.controls.star_rating.html('· · ·');\n                }\n                ,\n\n                do_end: function () {\n                    var stepdata = {};\n                    var grade = 50;\n                    stepdata.index=index;\n                    stepdata.grade= grade;\n                    quizhelper.do_next(stepdata);\n                },\n\n                is_end: function () {\n                    if (app.pointer < app.terms.length) {\n                        return false;\n                    } else {\n                        return true;\n                    }\n                },\n\n                progress_dots: function(results, terms) {\n\n                    var code = \"\";\n                    var color = \"\";\n                    terms.forEach(function(o, i) {\n                        color = \"darkgray\";\n                        if (results[i] !== undefined) {\n                            if (results[i].points) {\n                                color = \"green\";\n                            } else {\n                                color = \"red\";\n                            }\n                        }\n                        code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n                    });\n\n                    $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_progress_dots\").html(code);\n\n                },\n            }; //end of app definition\n            app.init();\n\n        } //end of init_App\n\n\n    }; //end of return value\n});"],"file":"speechcards.min.js"}