{"version":3,"sources":["../src/speechcards.js"],"names":["define","$","log","Ajax","def","polly","cloudpoodll","debug","init","index","itemdata","quizhelper","init_app","console","app","passmark","pointer","jsondata","props","dryRun","language","terms","results","controls","i","sentences","length","sentence","init_controls","initComponents","register_events","star_rating","uniqueid","next_button","on","do_next","hasgrade","totalitems","correctitems","grade","click","check","is_end","setTimeout","do_end","theCallback","message","type","speechtext","capturedspeech","cleanspeechtext","cleanText","spoken","correct","similarity","wordsDoMatch","showStarRating","flagCorrectAndTransition","checkByPhonetic","then","Deferred","reject","progress_dots","writeCurrentTerm","text","phraseheard","currentphrase","s1","s2","longer","shorter","longerLength","editDistance","parseFloat","toLowerCase","costs","lastValue","j","newValue","charAt","Math","min","replace","trim","call","stars","code","forEach","star","html","points","result","push","clearStarRating","stepdata","color","o"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'core/ajax','mod_poodlltime/definitions','mod_poodlltime/pollyhelper',\n    'mod_poodlltime/cloudpoodllloader'], function($, log,Ajax, def, polly, cloudpoodll) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('Poodll Time Speechcards: initialising');\n\n    return {\n\n        init: function(index, itemdata,quizhelper) {\n\n            this.init_app(index,itemdata,quizhelper);\n        },\n\n        init_app: function(index, itemdata, quizhelper) {\n\n            console.log(itemdata);\n          \n            var app = {\n                passmark: 75,\n                pointer: 1,\n                jsondata: null,\n                props: null,\n                dryRun: false,\n                language: 'en-US',\n                terms: [],\n                results: [],\n                controls: {},\n\n                init: function() {\n\n                    //init terms\n                    for(var i=0;i<itemdata.sentences.length;i++) {\n                        app.terms[i] = itemdata.sentences[i].sentence;\n                    }\n                    app.language = itemdata.language;\n\n                    this.init_controls();\n                    this.initComponents();\n                    this.register_events();\n                },\n\n                init_controls: function () {\n                    app.controls= {};\n                    app.controls.star_rating = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_star_rating\");\n                    app.controls.next_button = $(\"#\" + itemdata.uniqueid + \"_container .poodlltime-speechcards_nextbutton\");\n                }\n                ,\n\n                register_events: function () {\n                    //When click next button , report and leave it up to parent to eal with it.\n                    $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function (e) {\n                        var stepdata = {};\n                        stepdata.index = index;\n                        stepdata.hasgrade = true;\n                        stepdata.totalitems=4;\n                        stepdata.correctitems=2;\n                        stepdata.grade = 50;\n                        quizhelper.do_next(stepdata);\n                    });\n\n                    app.controls.next_button.click(function() {\n                        //user has given up ,update word as failed\n                        app.check(false);\n\n                        //transition if required\n                        if (app.is_end()) {\n                            setTimeout(function () {\n                                app.do_end();\n                            }, 200);\n                        } else {\n                            setTimeout(function () {\n                                app.do_next();\n                            }, 200);\n                        }\n\n                    });\n                }\n                ,\n\n                initComponents: function() {\n\n                    //The logic here is that on correct we transition.\n                    //on incorrect we do not. A subsequent nav button click then doesnt need to post a result\n                    var theCallback = function(message) {\n                        //console.log(\"triggered callback\");\n                        console.log(message);\n\n                        switch (message.type) {\n                            case 'recording':\n\n                                break;\n\n                            case 'speech':\n                                var speechtext = message.capturedspeech;\n                                var cleanspeechtext = app.cleanText(speechtext);\n\n                                var spoken = cleanspeechtext;\n                                var correct = app.terms[app.pointer - 1];\n\n                                //Similarity check by character matching\n                                var similarity = app.similarity(spoken,correct);\n                                log.debug('JS similarity: ' + spoken + ':' + correct +':' + similarity);\n\n                                //Similarity check by direct-match/acceptable-mistranscription\n                                if (similarity >= app.passmark ||\n                                    app.wordsDoMatch(cleanspeechtext, app.terms[app.pointer - 1]) ) {\n                                    log.debug('local match:' + ':' + spoken +':' + correct);\n                                    app.showStarRating(100);\n                                    app.flagCorrectAndTransition();\n                                    return;\n                                }\n\n                                //Similarity check by phonetics(ajax)\n                                app.checkByPhonetic(spoken,correct).then(function(similarity) {\n                                    if (similarity===false) {\n                                        return $.Deferred().reject();\n                                    }else{\n                                        log.debug('PHP similarity: ' + spoken + ':' + correct +':' + similarity);\n                                        app.showStarRating(similarity);\n                                        if(similarity>=app.passmark) {\n                                            app.flagCorrectAndTransition();\n                                        }\n                                    }//end of if check_by_phonetic result\n                                });//end of check by phonetic\n\n                        }//end of switch message type\n                    };\n\n                    //init cloudpoodll push recorder\n                    cloudpoodll.init('poodlltime-poodllrecorder', theCallback);\n\n                    //init progress dots\n                    app.progress_dots(app.results,app.terms);\n                  \n                    app.writeCurrentTerm();\n\n\n                },\n              \n                writeCurrentTerm:function(){\n                  $(\".poodlltime_speechcards_target_phrase\").text(app.terms[app.pointer-1]);\n                },\n\n                flagCorrectAndTransition: function () {\n\n                    //update students word log if matched\n                    app.check(true);\n\n                    //transition if required\n                    if (app.is_end()) {\n                        setTimeout(function () {\n                            app.do_end();\n                        }, 700);\n                    } else {\n                        setTimeout(function () {\n                            app.do_next();\n                        }, 700);\n                    }\n\n                },\n\n                wordsDoMatch: function(phraseheard, currentphrase) {\n                    //lets lower case everything\n                    phraseheard = app.cleanText(phraseheard);\n                    currentphrase = app.cleanText(currentphrase);\n                    if (phraseheard == currentphrase) {\n                        return true;\n                    }\n                    return false;\n                },\n\n                similarity: function (s1, s2) {\n                    var longer = s1;\n                    var shorter = s2;\n                    if (s1.length < s2.length) {\n                        longer = s2;\n                        shorter = s1;\n                    }\n                    var longerLength = longer.length;\n                    if (longerLength == 0) {\n                        return 1.0;\n                    }\n                    return (longerLength - app.editDistance(longer, shorter)) / parseFloat(longerLength);\n                }\n                ,\n                editDistance: function (s1, s2) {\n                    s1 = s1.toLowerCase();\n                    s2 = s2.toLowerCase();\n\n                    var costs = new Array();\n                    for (var i = 0; i <= s1.length; i++) {\n                        var lastValue = i;\n                        for (var j = 0; j <= s2.length; j++) {\n                            if (i == 0)\n                                costs[j] = j;\n                            else {\n                                if (j > 0) {\n                                    var newValue = costs[j - 1];\n                                    if (s1.charAt(i - 1) != s2.charAt(j - 1))\n                                        newValue = Math.min(Math.min(newValue, lastValue),\n                                            costs[j]) + 1;\n                                    costs[j - 1] = lastValue;\n                                    lastValue = newValue;\n                                }\n                            }\n                        }\n                        if (i > 0)\n                            costs[s2.length] = lastValue;\n                    }\n                    return costs[s2.length];\n                }\n                ,\n\n                cleanText: function (text) {\n                    return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n                }\n                ,\n\n                //this will return the promise, the result of which is an integer 100 being perfect match, 0 being no match\n                checkByPhonetic: function (spoken, correct) {\n\n                    return Ajax.call([{\n                        'methodname': 'mod_poodlltime_check_by_phonetic',\n                        'args': {\n                            'spoken': spoken,\n                            'correct': correct,\n                            'language': app.language,\n                        }\n                    }])[0];\n\n                },\n\n                showStarRating: function(similarity){\n                    //how many stars code\n                    var stars = [true,true,true];\n                    if(similarity<1){\n                        stars=[true,true,false];\n                    }\n                    if(similarity<app.passmark){\n                        stars=[true,false,false];\n                    }\n                    if(similarity<0.5){\n                        stars=[false,false,false];\n                    }\n                    console.log(stars,similarity);\n\n                    //prepare stars html\n                    var code=\"\";\n                    stars.forEach(function(star){\n                        if(star===true){\n                            code+='<i class=\"fa fa-star\"></i>';\n                        }\n                        else{\n                            code+='<i class=\"fa fa-star-o\"></i>';\n                        }\n                    });\n                    console.log(code);\n                    app.controls.star_rating.html(code);\n                },\n\n                check: function (correct) {\n                    var points = 1;\n                    if (correct == true) {\n                        points = 1;\n                    } else {\n                        points = 0;\n                    }\n                    var result = {points: points};\n                    app.results.push(result);\n                },\n\n                do_next: function () {\n                    app.pointer++;\n                    app.progress_dots(app.results, app.terms);\n                    app.clearStarRating();\n                    if (!app.is_end()) {\n                        app.writeCurrentTerm();\n                    } else {\n                        app.do_end();\n                    }\n                },\n\n                clearStarRating: function () {\n                    app.controls.star_rating.html('· · ·');\n                },\n\n                do_end: function () {\n                    var stepdata = {};\n                    var grade = 50;\n                    stepdata.index=index;\n                    stepdata.grade= grade;\n                    quizhelper.do_next(stepdata);\n                },\n\n                is_end: function () {\n                    if (app.pointer < app.terms.length) {\n                        return false;\n                    } else {\n                        return true;\n                    }\n                },\n\n                progress_dots: function(results, terms) {\n\n                    var code = \"\";\n                    var color = \"\";\n                    terms.forEach(function(o, i) {\n                        color = \"darkgray\";\n                        if (results[i] !== undefined) {\n                            if (results[i].points) {\n                                color = \"green\";\n                            } else {\n                                color = \"red\";\n                            }\n                        }\n                        code += '<i style=\"color:' + color + ';\" class=\"fa fa-circle\"></i>';\n                    });\n\n                    $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_progress_dots\").html(code);\n\n                },\n            }; //end of app definition\n            app.init();\n\n        } //end of init_App\n\n\n    }; //end of return value\n});"],"file":"speechcards.min.js"}