define ("mod_poodlltime/dictation",["jquery","core/log","mod_poodlltime/definitions","mod_poodlltime/pollyhelper"],function(a,b,c,d){"use strict";b.debug("Poodll Time Quiz helper: initialising");return{playing:!1,init:function init(a,b,c,d){this.prepare_audio(b,d);this.register_events(a,b,c)},prepare_html:function prepare_html(){},prepare_audio:function prepare_audio(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.sentence,"text","Amy").then(function(d){a("#"+b.uniqueid+"_container .dictationplayer_"+c+" .dictationtrigger").attr("data-src",d)})})},register_events:function register_events(b,c,d){var e=this,f=a("#"+c.uniqueid+"_player");a("#"+c.uniqueid+"_container .poodlldictationinput input").on("input",function(){var b=a(this).data("index"),d=c.sentences[b].sentence.trim().toLowerCase(),e=a(this).val().trim().toLowerCase();a("#"+c.uniqueid+"_container .dictationplayer_"+b+"_chars").html(e.length);if(d==e){a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+b+"']").removeClass("fa-times").addClass("fa-check")}else{a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+b+"']").removeClass("fa-check").addClass("fa-times")}});a("#"+c.uniqueid+"_container .dictationtrigger").on("click",function(){if(!e.playing){var b=this;e.playing=!0;f.attr("src",a(this).attr("data-src"));f[0].play();f[0].onended=function(){a(b).find(".fa").removeClass("fa-spin fa-spinner").addClass("fa-play");e.playing=!1};a(b).find(".fa").removeClass("fa-play").addClass("fa-spin fa-spinner")}});a("#"+c.uniqueid+"_container .poodlltime_nextbutton").on("click",function(){var e={},f=a("#"+c.uniqueid+"_container .dictate-feedback.fa-check").length,g=a("#"+c.uniqueid+"_container .dictate-feedback").length,h=100*Math.round(f/g,2);e.index=b;e.grade=h;d.do_next(e)})}}});
//# sourceMappingURL=dictation.min.js.map
