define(["jquery","core/log","mod_poodlltime/definitions","mod_poodlltime/pollyhelper"],function(a,b,c,d){"use strict";return b.debug("Poodll Time Quiz helper: initialising"),{playing:!1,init:function(a,b,c,d){this.prepare_audio(b,d),this.register_events(a,b,c)},prepare_html:function(a){},prepare_audio:function(b){a.each(b.sentences,function(c,e){d.fetch_polly_url(e.sentence,"text","Amy").then(function(d){a("#"+b.uniqueid+"_container .dictationplayer_"+c+" .dictationtrigger").attr("data-src",d)})})},register_events:function(b,c,d){var e=this,f=a("#"+c.uniqueid+"_player");a("#"+c.uniqueid+"_container .poodlldictationinput input").on("input",function(b){var d=a(this).data("index"),e=c.sentences[d].sentence.trim().toLowerCase(),f=a(this).val().trim().toLowerCase();a("#"+c.uniqueid+"_container .dictationplayer_"+d+"_chars").html(f.length),e==f?a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+d+"']").removeClass("fa-times").addClass("fa-check").css("color","green").show():a("#"+c.uniqueid+"_container .dictate-feedback[data-index='"+d+"']").removeClass("fa-check").addClass("fa-times").css("color","red").show()}),a("#"+c.uniqueid+"_container .dictationtrigger").on("click",function(b){if(!e.playing){var c=this;e.playing=!0,f.attr("src",a(this).attr("data-src")),f[0].play(),f[0].onended=function(){a(c).find(".fa").removeClass("fa-spin fa-spinner").addClass("fa-play"),e.playing=!1},a(c).find(".fa").removeClass("fa-play").addClass("fa-spin fa-spinner")}}),a("#"+c.uniqueid+"_container .poodlltime_nextbutton").on("click",function(e){var f={},g=a("#"+c.uniqueid+"_container .dictate-feedback.fa-check").length,h=a("#"+c.uniqueid+"_container .dictate-feedback").length,i=100*Math.round(g/h,2);f.index=b,f.hasgrade=!0,f.grade=i,f.totalitems=h,f.correctitems=g,f.grade=i,d.do_next(f)})}}});