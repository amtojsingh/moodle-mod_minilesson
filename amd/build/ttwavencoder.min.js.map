{"version":3,"sources":["../src/ttwavencoder.js"],"names":["define","$","log","debug","ttw","init","sampleRate","numChannels","numSamples","dataViews","encode","buffer","len","length","nCh","view","DataView","ArrayBuffer","offset","i","ch","x","setInt16","Math","max","min","push","setString","str","setUint8","charCodeAt","finish","dataSize","setUint32","setUint16","unshift","blob","Blob","type","cleanup","cancel"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log'], function ($, log) {\n    \"use strict\"; // jshint ;_;\n    /*\n    This file is the engine that drives audio rec and canvas drawing. TT Recorder is the just the glory kid\n     */\n\n    log.debug('TT Wav Encoder initialising');\n\n    var ttw = {\n\n\n\n        init: function(sampleRate, numChannels) {\n            ttw.sampleRate = sampleRate;\n            ttw.numChannels = numChannels;\n            ttw.numSamples = 0;\n            ttw.dataViews = [];\n        },\n\n        encode: function(buffer) {\n            //this would be an event that occurs after recorder has stopped lets just ignore it\n            if(ttw.dataViews===undefined){\n                return;\n            }\n\n            var len = buffer[0].length,\n                nCh = ttw.numChannels,\n                view = new DataView(new ArrayBuffer(len * nCh * 2)),\n                offset = 0;\n            for (var i = 0; i < len; ++i)\n                for (var ch = 0; ch < nCh; ++ch) {\n                    var x = buffer[ch][i] * 0x7fff;\n                    view.setInt16(offset, x < 0 ? Math.max(x, -0x8000) : Math.min(x, 0x7fff), true);\n                    offset += 2;\n                }\n            ttw.dataViews.push(view);\n            ttw.numSamples += len;\n        },\n\n        setString: function(view, offset, str) {\n            var len = str.length;\n            for (var i = 0; i < len; ++i) {\n                view.setUint8(offset + i, str.charCodeAt(i));\n            }\n        },\n\n        finish: function(mimeType) {\n            var dataSize = ttw.numChannels * ttw.numSamples * 2;\n            var view = new DataView(new ArrayBuffer(44));\n            ttw.setString(view, 0, 'RIFF');\n            view.setUint32(4, 36 + dataSize, true);\n            ttw.setString(view, 8, 'WAVE');\n            ttw.setString(view, 12, 'fmt ');\n            view.setUint32(16, 16, true);\n            view.setUint16(20, 1, true);\n            view.setUint16(22, ttw.numChannels, true);\n            view.setUint32(24, ttw.sampleRate, true);\n            view.setUint32(28, ttw.sampleRate * 4, true);\n            view.setUint16(32, ttw.numChannels * 2, true);\n            view.setUint16(34, 16, true);\n            ttw.setString(view, 36, 'data');\n            view.setUint32(40, dataSize, true);\n            ttw.dataViews.unshift(view);\n            var blob = new Blob(ttw.dataViews, { type: 'audio/wav' });\n            ttw.cleanup();\n            return blob;\n        },\n\n        cancel: function() {\n            delete ttw.dataViews;\n        },\n\n        cleanup: function() {\n            ttw.cancel();\n        }\n\n     };//end of return value\n    return ttw;\n});"],"file":"ttwavencoder.min.js"}