define(["jquery","core/log","mod_poodlltime/definitions","mod_poodlltime/dependencyloader","theme_boost/popover"],function(a,b,c){"use strict";return b.debug("Popover helper: initialising"),{lastitem:!1,okbuttonclass:c.okbuttonclass,ngbuttonclass:c.ngbuttonclass,msvclosebuttonclass:c.msvclosebuttonclass,s_buttonclass:c.s_buttonclass,m_buttonclass:c.m_buttonclass,v_buttonclass:c.v_buttonclass,correctbuttonclass:c.correctbuttonclass,errorbuttonclass:c.errorbuttonclass,selfcorrectbuttonclass:c.selfcorrectbuttonclass,msvgradebuttonclass:c.msvgradebutton,msvcontainerclass:c.msvcontainerclass,msvbuttonsbox:c.msvbuttonsbox,quickgradecontainer:c.quickgradecontainerclass,stateerror:c.stateerror,statecorrect:c.statecorrect,stateselfcorrect:c.stateselfcorrect,quickgradetitle:M.util.get_string("quickgrade",c.component),transcripttitle:M.util.get_string("transcript",c.component),msvtitle:M.util.get_string("msv",c.component),oklabel:M.util.get_string("ok",c.component),nglabel:M.util.get_string("ng",c.component),msvcloselabel:M.util.get_string("msvcloselabel",c.component),s_label:M.util.get_string("s_label",c.component),m_label:M.util.get_string("m_label",c.component),v_label:M.util.get_string("v_label",c.component),errorlabel:M.util.get_string("error",c.component),correctlabel:M.util.get_string("correct",c.component),selfcorrectlabel:M.util.get_string("selfcorrect",c.component),dispose:!1,init:function(){this.register_events()},register_events:function(){var b=this;a(document).on("click","."+this.okbuttonclass,this.onAccept),a(document).on("click","."+this.ngbuttonclass,this.onReject),a(document).on("click","."+this.msvclosebuttonclass,this.onMSVClose),a(document).on("click","."+this.msvgradebuttonclass,function(){a('input[name="msvitem"]:checked').val()!==b.statecorrect&&("0"==a(this).attr("data-checked")?a(this).attr("data-checked","1"):a(this).attr("data-checked","0"))}),a(document).on("change",".msvtoggleform",function(){a('input[name="msvitem"]:checked').val()===b.statecorrect&&(a("."+b.s_buttonclass).attr("data-checked","0"),a("."+b.m_buttonclass).attr("data-checked","0"),a("."+b.v_buttonclass).attr("data-checked","0"))})},disposeWord:function(){if(this.dispose)return this.dispose;var b="3";switch(a.fn.popover.Constructor.hasOwnProperty("VERSION")&&(b=a.fn.popover.Constructor.VERSION.charAt(0)),b){case"4":this.dispose="dispose";break;case"3":default:this.dispose="destroy"}return this.dispose},remove:function(b){b?a(b).popover(this.disposeWord()):this.lastitem&&(a(this.lastitem).popover(this.disposeWord()),this.lastitem=!1)},addQuickGrader:function(b){this.lastitem&&this.lastitem!==b&&(a(this.lastitem).popover(this.disposeWord()),this.lastitem=!1),this.lastitem=b;var c=this,d=function(){var b=a(this).attr("data-wordnumber"),d="<button type='button' class='btn "+c.okbuttonclass+"' data-wordnumber='"+b+"'><i class='fa fa-check'></i> "+c.oklabel+"</button>",e="<button type='button' class='btn "+c.ngbuttonclass+"' data-wordnumber='"+b+"'><i class='fa fa-close'></i> "+c.nglabel+"</button>",f="<div class='"+c.quickgradecontainerclass+"'>"+d+e+"</div>";return f};a(b).popover({title:this.quickgradetitle,content:d,trigger:"manual",placement:"top",html:!0}),a(b).popover("show")},addMSVGrader:function(b,c){this.lastitem&&this.lastitem!==b&&(a(this.lastitem).popover(this.disposeWord()),this.lastitem=!1),this.lastitem=b;var d=this,e=function(){var b=a(this).attr("data-wordnumber"),e='<form class="msvtoggleform">';e+='<div class="btn-group btn-group-toggle" data-toggle="buttons">';var f=c.state===d.statecorrect?"checked":"",g=c.state===d.statecorrect?"active":"";e+='<label for="'+d.correctbuttonclass+'" class="btn btn-secondary  '+g+'">',e+='<input id="'+d.correctbuttonclass+'" name="msvitem" type="radio" '+f+' value="'+d.statecorrect+'">',e+=d.correctlabel+"</label>",f=c.state===d.stateerror?"checked":"",g=c.state===d.stateerror?"active":"",e+='<label for="'+d.errorbuttonclass+'" class="btn btn-secondary '+g+'">',e+='<input id="'+d.errorbuttonclass+'" name="msvitem" type="radio" '+f+'  value="'+d.stateerror+'">',e+=d.errorlabel+"</label>",f=c.state===d.stateselfcorrect?"checked":"",g=c.state===d.stateselfcorrect?"active":"",e+='<label for="'+d.selfcorrectbuttonclass+'" class="btn btn-secondary '+g+'">',e+='<input id="'+d.selfcorrectbuttonclass+'" name="msvitem" type="radio" '+f+' value="'+d.stateselfcorrect+'">',e+=d.selfcorrectlabel+"</label>",e+="</div>",e+="</form>";var h="<button type='button' data-checked='"+c.msv.m+"' class='btn "+d.m_buttonclass+" "+d.msvgradebuttonclass+"'>"+d.m_label+"</button>";h+="<button type='button' data-checked='"+c.msv.s+"' class='btn "+d.s_buttonclass+" "+d.msvgradebuttonclass+"'>"+d.s_label+"</button>",h+="<button type='button' data-checked='"+c.msv.v+"' class='btn "+d.v_buttonclass+" "+d.msvgradebuttonclass+"'>"+d.v_label+"</button>";var i="<div class='"+d.msvbuttonsbox+"'>"+h+"</div>",j="<button type='button' class='btn "+d.msvclosebuttonclass+"' data-wordnumber='"+b+"'>"+d.msvcloselabel+"</button>",k="<div class='"+d.msvcontainerclass+"'>"+e+i+j+"</div>";return k};a(b).popover({title:this.msvtitle,content:e,trigger:"manual",placement:"top",html:!0}),a(b).popover("show")},fetchMSVResults:function(){var b={};return b.msv={},b.msv.m=a("."+this.m_buttonclass).attr("data-checked"),b.msv.s=a("."+this.s_buttonclass).attr("data-checked"),b.msv.v=a("."+this.v_buttonclass).attr("data-checked"),b.state=a('input[name="msvitem"]:checked').val(),b},addTranscript:function(b,c){return this.lastitem==b?(a(this.lastitem).popover(this.disposeWord()),void(this.lastitem=!1)):(this.lastitem&&(a(this.lastitem).popover(this.disposeWord()),this.lastitem=!1),this.lastitem=b,a(b).popover({title:this.transcripttitle,content:c,trigger:"manual",placement:"top"}),void a(b).popover("show"))},onAccept:function(){alert(a(this).attr("data-wordnumber"))},onReject:function(){alert(a(this).attr("data-wordnumber"))},onMSVClose:function(){alert(a(this).attr("data-wordnumber"))}}});