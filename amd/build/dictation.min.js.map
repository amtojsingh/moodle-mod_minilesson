{"version":3,"sources":["../src/dictation.js"],"names":["define","$","log","def","polly","debug","playing","clone","extend","init","index","itemdata","quizhelper","prepare_audio","register_events","prepare_html","each","sentences","sentence","fetch_polly_url","then","audiourl","uniqueid","attr","self","theplayer","on","data","correct","trim","toLowerCase","typed","val","html","length","removeClass","addClass","css","show","el","play","onended","find","stepdata","total","grade","Math","round","hasgrade","totalitems","correctitems","do_next"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_minilesson/definitions', 'mod_minilesson/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Time Quiz helper: initialising');\n\n  return {\n\n    playing: false,\n\n      //for making multiple instances\n      clone: function () {\n          return $.extend(true, {}, this);\n      },\n\n\n      init: function(index, itemdata, quizhelper, polly) {\n\n      this.prepare_audio(itemdata, polly);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    prepare_html: function(itemdata) {\n      //do something\n    },\n\n    prepare_audio: function(itemdata) {\n      $.each(itemdata.sentences, function(index, sentence) {\n        polly.fetch_polly_url(sentence.sentence, 'text', 'Amy').then(function(audiourl) {\n          $(\"#\" + itemdata.uniqueid + \"_container .dictationplayer_\" + index + \" .dictationtrigger\").attr(\"data-src\", audiourl);\n        });\n      });\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n\n      //key events in text box\n      $(\"#\" + itemdata.uniqueid + \"_container .poodlldictationinput input\").on(\"input\", function(e) {\n\n        var index = $(this).data(\"index\");\n        var correct = itemdata.sentences[index].sentence.trim().toLowerCase();\n        var typed = $(this).val().trim().toLowerCase();\n        $(\"#\"+itemdata.uniqueid+\"_container .dictationplayer_\"+index+\"_chars\").html(typed.length);\n        if (correct == typed) {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-times\").addClass(\"fa-check\").css(\"color\",\"green\").show();\n        } else {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-check\").addClass(\"fa-times\").css(\"color\",\"red\").show();\n        }\n\n      });\n\n      //audio play requests\n      $(\"#\" + itemdata.uniqueid + \"_container .dictationtrigger\").on('click', function(e) {\n        if (!self.playing) {\n          var el = this;\n          self.playing = true;\n          theplayer.attr('src', $(this).attr('data-src'));\n          theplayer[0].play();\n          theplayer[0].onended = function() {\n            $(el).find(\".fa\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n            self.playing = false;\n          }\n          $(el).find(\".fa\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n        }\n      });\n\n      //When click next button , report and leave it up to parent to eal with it.\n      $(\"#\" + itemdata.uniqueid + \"_container .minilesson_nextbutton\").on('click', function(e) {\n        var stepdata = {};\n        var correct = $('#' + itemdata.uniqueid + '_container .dictate-feedback.fa-check').length;\n        var total = $('#' + itemdata.uniqueid + '_container .dictate-feedback').length;\n        var grade = Math.round(correct / total, 2) * 100;\n        stepdata.index = index;\n        stepdata.hasgrade = true;\n        stepdata.grade = grade;\n        stepdata.totalitems=total;\n        stepdata.correctitems=correct;\n        stepdata.grade = grade;\n        quizhelper.do_next(stepdata);\n      });\n    }\n  }; //end of return value\n});"],"file":"dictation.min.js"}