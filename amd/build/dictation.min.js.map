{"version":3,"sources":["../src/dictation.js"],"names":["define","$","log","def","polly","debug","init","index","itemdata","quizhelper","prepare_audio","register_events","prepare_html","each","sentences","sentence","fetch_polly_url","then","audiourl","uniqueid","attr","theplayer","on","data","correct","trim","toLowerCase","typed","val","removeClass","addClass","play","stepdata","length","total","grade","Math","round","do_next"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_poodlltime/definitions','mod_poodlltime/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Time Quiz helper: initialising');\n\n  return {\n\n\n    init: function(index, itemdata,quizhelper, polly) {\n\n      this.prepare_audio(itemdata,polly);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    prepare_html: function(itemdata) {\n      //do something\n    },\n\n    prepare_audio: function(itemdata) {\n        $.each(itemdata.sentences,function(index,sentence) {\n          polly.fetch_polly_url(sentence.sentence,'text','Amy').then(function(audiourl){\n            $(\"#\" + itemdata.uniqueid + \"_container .dictationplayer_\" + index + \" .dictationtrigger\").attr(\"data-src\",audiourl);\n          });\n        });\n    },\n\n    register_events: function(index,itemdata,quizhelper) {\n\n        var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n\n       //key events in text box\n        $(\"#\" + itemdata.uniqueid + \"_container .poodlldictationinput input\").on(\"input\",function(e){\n\n          var index = $(this).data(\"index\");\n          var correct = itemdata.sentences[index].sentence.trim().toLowerCase();\n          var typed = $(this).val().trim().toLowerCase();\n          if(correct == typed){\n            $(\".dictate-feedback[data-index='\"+index+\"']\").removeClass(\"fa-times\").addClass(\"fa-check\");\n          } else {\n            $(\".dictate-feedback[data-index='\"+index+\"']\").removeClass(\"fa-check\").addClass(\"fa-times\");\n          }\n\n        });\n\n        //audio play requests\n        $(\"#\" + itemdata.uniqueid + \"_container .dictationtrigger\").on('click', function(e){\n            theplayer.attr('src',$(this).attr('data-src'));\n            theplayer[0].play();\n        });\n\n        //When click next button , report and leave it up to parent to eal with it.\n        $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function(e){\n            var stepdata = {};\n            var correct = $('#' + itemdata.uniqueid + '_container .dictate-feedback.fa-check').length;\n            var total = $('#' + itemdata.uniqueid + '_container .dictate-feedback').length;\n            var grade = Math.round(correct/total,2) * 100;\n            stepdata.index=index;\n            stepdata.grade= grade;\n            quizhelper.do_next(stepdata);\n        });\n    }\n  }; //end of return value\n});"],"file":"dictation.min.js"}