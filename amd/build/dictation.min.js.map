{"version":3,"sources":["../src/dictation.js"],"names":["define","$","log","def","polly","debug","playing","init","index","itemdata","quizhelper","prepare_audio","register_events","prepare_html","each","sentences","sentence","fetch_polly_url","then","audiourl","uniqueid","attr","self","theplayer","on","data","correct","trim","toLowerCase","typed","val","html","length","removeClass","addClass","el","play","onended","find","stepdata","total","grade","Math","round","hasgrade","totalitems","correctitems","do_next"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_poodlltime/definitions', 'mod_poodlltime/pollyhelper'], function($, log, def, polly) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Time Quiz helper: initialising');\n\n  return {\n\n    playing: false,\n\n    init: function(index, itemdata, quizhelper, polly) {\n\n      this.prepare_audio(itemdata, polly);\n      this.register_events(index, itemdata, quizhelper);\n\n    },\n\n    prepare_html: function(itemdata) {\n      //do something\n    },\n\n    prepare_audio: function(itemdata) {\n      $.each(itemdata.sentences, function(index, sentence) {\n        polly.fetch_polly_url(sentence.sentence, 'text', 'Amy').then(function(audiourl) {\n          $(\"#\" + itemdata.uniqueid + \"_container .dictationplayer_\" + index + \" .dictationtrigger\").attr(\"data-src\", audiourl);\n        });\n      });\n    },\n\n    register_events: function(index, itemdata, quizhelper) {\n\n      var self = this;\n\n      var theplayer = $(\"#\" + itemdata.uniqueid + \"_player\");\n\n      //key events in text box\n      $(\"#\" + itemdata.uniqueid + \"_container .poodlldictationinput input\").on(\"input\", function(e) {\n\n        var index = $(this).data(\"index\");\n        var correct = itemdata.sentences[index].sentence.trim().toLowerCase();\n        var typed = $(this).val().trim().toLowerCase();\n        $(\"#\"+itemdata.uniqueid+\"_container .dictationplayer_\"+index+\"_chars\").html(typed.length);\n        if (correct == typed) {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-times\").addClass(\"fa-check\");\n        } else {\n          $(\"#\"+itemdata.uniqueid+\"_container .dictate-feedback[data-index='\" + index + \"']\").removeClass(\"fa-check\").addClass(\"fa-times\");\n        }\n\n      });\n\n      //audio play requests\n      $(\"#\" + itemdata.uniqueid + \"_container .dictationtrigger\").on('click', function(e) {\n        if (!self.playing) {\n          var el = this;\n          self.playing = true;\n          theplayer.attr('src', $(this).attr('data-src'));\n          theplayer[0].play();\n          theplayer[0].onended = function() {\n            $(el).find(\".fa\").removeClass(\"fa-spin fa-spinner\").addClass(\"fa-play\");\n            self.playing = false;\n          }\n          $(el).find(\".fa\").removeClass(\"fa-play\").addClass(\"fa-spin fa-spinner\");\n        }\n      });\n\n      //When click next button , report and leave it up to parent to eal with it.\n      $(\"#\" + itemdata.uniqueid + \"_container .poodlltime_nextbutton\").on('click', function(e) {\n        var stepdata = {};\n        var correct = $('#' + itemdata.uniqueid + '_container .dictate-feedback.fa-check').length;\n        var total = $('#' + itemdata.uniqueid + '_container .dictate-feedback').length;\n        var grade = Math.round(correct / total, 2) * 100;\n        stepdata.index = index;\n        stepdata.hasgrade = true;\n        stepdata.grade = grade;\n        stepdata.totalitems=total;\n        stepdata.correctitems=correct;\n        stepdata.grade = grade;\n        quizhelper.do_next(stepdata);\n      });\n    }\n  }; //end of return value\n});"],"file":"dictation.min.js"}