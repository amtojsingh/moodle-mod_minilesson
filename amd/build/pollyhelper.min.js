define(["jquery","core/log"],function(a,b){"use strict";return b.debug("Polly helper: initialising"),{token:"",region:"",owner:"",init:function(a,b,c){this.token=a,this.region=b,this.owner=c},fetch_polly_url:function(a,c,d){var e=this;return new Promise(function(f,g){var h="local_cpapi_fetch_polly_url",i=new XMLHttpRequest;i.onreadystatechange=function(a){if(4===this.readyState)if(200==i.status){var c=i.responseText,d=JSON.parse(c);if(d){if(d.returnCode>0)return g(d.returnMessage),b.debug(d.returnMessage),!1;if(0===d.returnCode){var e=d.returnMessage;f(e)}else g("Polly Signed URL Request failed:"),b.debug("Polly Signed URL Request failed:"),b.debug(d)}else g("Polly Signed URL Request something bad happened"),b.debug("Polly Signed URL Request something bad happened")}else g("Polly Signed URL Request Not 200 response:"+i.status),b.debug("Polly Signed URL Request Not 200 response:"+i.status)};var j="wstoken="+e.token+"&wsfunction="+h+"&moodlewsrestformat=json&text="+encodeURIComponent(a)+"&texttype="+c+"&voice="+d+"&appid=mod_poodlltime&owner="+e.owner+"&region="+e.region,k="https://cloud.poodll.com/webservice/rest/server.php";i.open("POST",k,!0),i.setRequestHeader("Cache-Control","no-cache"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(j)})}}});