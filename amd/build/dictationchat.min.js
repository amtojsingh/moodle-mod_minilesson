define ("mod_poodlltime/dictationchat",["jquery","core/log","mod_poodlltime/definitions","mod_poodlltime/pollyhelper"],function(a,b,c,d){"use strict";b.debug("Poodll Time dictation chat: initialising");return{init:function init(a,b,c){var d=this;d.itemdata=b;d.quizhelper=c;d.index=a;d.register_events();d.setvoice();d.getItems()},register_events:function register_events(){var b=this;a("#"+b.itemdata.uniqueid+"_container .poodlltime_nextbutton").on("click",function(){var a={};a.index=index;a.grade=50;b.quizhelper.do_next(a)});a("#"+b.itemdata.uniqueid+"_container .dictate_start_btn").on("click",function(){b.start()});a("#"+b.itemdata.uniqueid+"_container .dictate_listen_btn").on("click",function(){b.items[b.game.pointer].audio.load();b.items[b.game.pointer].audio.play()});a("#"+b.itemdata.uniqueid+"_container .dictate_skip_btn").on("click",function(){a("#"+b.itemdata.uniqueid+"_container .dictate_ctrl-btn").prop("disabled",!0);a("#"+b.itemdata.uniqueid+"_container .dictate_speech.dictate_teacher_left").text(b.items[b.game.pointer].target+"");setTimeout(function(){if(b.game.pointer<b.items.length-1){b.items[b.game.pointer].answered=!0;b.items[b.game.pointer].correct=!1;b.game.pointer++;b.nextPrompt()}else{b.end()}},3e3)});a("#"+b.itemdata.uniqueid+"_container .dictate_check_btn").on("click",function(){var c=b.items[b.game.pointer].target,d=[];a("#"+b.itemdata.uniqueid+"_container .dictate_targetWord").each(function(){d.push(""==a(this).val().trim()?"|":a(this).val().trim())});var e=d.join(" ");b.getComparison(c,e,function(a){b.gotComparison(a,e)})})},spliton:/([,.!?:;" ])/g,game:{pointer:0},usevoice:"Amy",setvoice:function setvoice(){var a=this,b="Female",c="Amy";c="Kendra";a.usevoice=c},getItems:function getItems(){var b=this,c=b.itemdata.customtext1.split("\n");b.items=c.map(function(a){return{dictate_targetWords:a.trim().split(b.spliton).filter(function(a){return""!==a}),target:a,typed:"",answered:!1,correct:!1,audio:null}}).filter(function(a){return""!==a.target});a.each(b.items,function(a,c){d.fetch_polly_url(c.target,"text","Amy").then(function(a){c.audio=new Audio;c.audio.src=a;if(0==b.items.filter(function(a){return null==a.audio}).length){b.appReady()}else{console.log(b.items)}})})},appReady:function appReady(){var b=this;a("#"+b.itemdata.uniqueid+"_container .dictate_not_loaded").hide();a("#"+b.itemdata.uniqueid+"_container .dictate_loaded").show();a("#"+b.itemdata.uniqueid+"_container .dictate_start_btn").prop("disabled",!1)},gotComparison:function gotComparison(b,c){var d=this;a("#"+d.itemdata.uniqueid+"_container .dictate_targetWord").addClass("dictate_correct").removeClass("dictate_incorrect");if(!Object.keys(b).length){a("#"+d.itemdata.uniqueid+"_container .dictate_speech.dictate_teacher_left").text(d.items[d.game.pointer].target+"");d.items[d.game.pointer].answered=!0;d.items[d.game.pointer].correct=!0;d.items[d.game.pointer].typed=c;a("#"+d.itemdata.uniqueid+"_container .dictate_ctrl-btn").prop("disabled",!0);if(d.game.pointer<d.items.length-1){setTimeout(function(){d.game.pointer++;d.nextPrompt()},3e3)}else{setTimeout(function(){d.end()},3e3)}}else{Object.keys(b).forEach(function(b){a("#"+d.itemdata.uniqueid+"_container .dictate_targetWord[data-idx='"+b+"']").removeClass("dictate_correct").addClass("dictate_incorrect")});a("#"+d.itemdata.uniqueid+"_container .dictate_reply_"+d.game.pointer).effect("shake",function(){a("#"+d.itemdata.uniqueid+"_container .dictate_ctrl-btn").prop("disabled",!1)})}a("#"+d.itemdata.uniqueid+"_container .dictate_targetWord.dictate_correct").each(function(){var b=a(this).data("realidx"),c=d.items[d.game.pointer].dictate_targetWords[b];a(this).val(c).prop("disabled",!0)})},getWords:function getWords(a){var b=this;if("false"==!1){a=a.toLowerCase()}for(var c=a.split(b.spliton).filter(function(a){return""!==a}),d=[],e=0;e<c.length;e++){if(!c[e].match(b.spliton)){d.push(c[e])}}return d},getSimpleComparison:function getSimpleComparison(a,b,c){for(var d=this,e=d.getWords(a),f=d.getWords(b),g={},h=0;h<e.length&&h<f.length;h++){if(e[h]!=f[h]){g[h+1]={word:e[h],number:h+1}}}c(g)},getComparison:function getComparison(b,c,d){var e=this;if("simple"=="simple"){e.getSimpleComparison(b,c,d);return}a(".dictate_ctrl-btn").prop("disabled",!0);this.ajax.call([{methodname:"mod_readaloud_compare_passage_to_transcript",args:{passage:b,transcript:c,alternatives:"",language:"en-US"},done:function done(a){var b=JSON.parse(a);if(b){d(b)}else{d(!1)}},fail:function fail(a){console.log(a)}}])},end:function end(){var b=this,c=b.items.filter(function(a){return a.correct}).length,d=b.items.length;a("#"+b.itemdata.uniqueid+"_container .dictate_results").html("TOTAL<br/>"+c+"/"+d).show();setTimeout(function(){a("#"+b.itemdata.uniqueid+"_container .dictate_results").fadeOut()},2e3);a("#"+b.itemdata.uniqueid+"_container .dictate_game").hide();a("#"+b.itemdata.uniqueid+"_container .dictate_start_btn").show();a("#"+b.itemdata.uniqueid+"_container .dictate_mainmenu").show();a("#"+b.itemdata.uniqueid+"_container .dictate_controls").hide();a("#"+b.itemdata.uniqueid+"_container .dictate_title").html("Listen and Repeat")},start:function start(){var b=this;a("#"+b.itemdata.uniqueid+"_container .dictate_ctrl-btn").prop("disabled",!0);b.items.forEach(function(a){a.spoken="";a.answered=!1;a.correct=!1});b.game.pointer=0;a("#"+b.itemdata.uniqueid+"_container .dictate_game").show();a("#"+b.itemdata.uniqueid+"_container .dictate_start_btn").hide();a("#"+b.itemdata.uniqueid+"_container .dictate_mainmenu").hide();a("#"+b.itemdata.uniqueid+"_container .dictate_controls").show();b.nextPrompt()},nextPrompt:function nextPrompt(){var b=this,c=b.items[b.game.pointer].target,d="<div class='dictate_prompt dictate_prompt_"+b.game.pointer+"' style='display:none;'>";d+="<i class='fa fa-graduation-cap dictate_speech-icon-left'></i>";d+="<div style='margin-left:90px;' class='dictate_speech dictate_teacher_left'>";d+=c.replace(/[^a-zA-Z0-9 ]/g,"").replace(/[a-zA-Z0-9]/g,"\u2022");d+="</div>";d+="</div>";a("#"+b.itemdata.uniqueid+"_container .dictate_game").html(d);a(".dictate_ctrl-btn").prop("disabled",!1);var e,f=b.items.map(function(a,c){e="gray";if(b.items[c].answered&&b.items[c].correct){e="green"}else if(b.items[c].answered&&!b.items[c].correct){e="red"}return"<i style='color:"+e+"' class='fa fa-circle'></i>"}).join(" ");a("#"+b.itemdata.uniqueid+"_container .dictate_title").html(f);a(".dictate_prompt_"+b.game.pointer).toggle("slide",{direction:"left"});b.nextReply()},nextReply:function nextReply(){var b=this,c=b.items[b.game.pointer].target,d="<div class='dictate_reply dictate_reply_"+b.game.pointer+"' style='display:none;'>";d+="<i class='fa fa-user dictate_speech-icon-right'></i>";var e="",f=1;b.items[b.game.pointer].dictate_targetWords.forEach(function(a,c){if(!a.match(b.spliton)){e+="<input type='text' maxlength='"+a.length+"' size='"+(a.length+1)+"' class='dictate_targetWord' data-realidx='"+c+"' data-idx='"+f+"'>";f++}else{e+=a}});d+="<div style='margin-right:90px;' class='dictate_speech dictate_right'>"+e+"</div>";d+="</div>";a("#"+b.itemdata.uniqueid+"_container .dictate_game").append(d);a(".dictate_reply_"+b.game.pointer).toggle("slide",{direction:"right"});a("#"+b.itemdata.uniqueid+"_container .dictate_ctrl-btn").prop("disabled",!1)},animateCSS:function animateCSS(a,b,c){var e=document.querySelector(a);e.classList.add("animated",b);function d(){e.classList.remove("animated",b);e.removeEventListener("animationend",d);if("function"==typeof c)c()}e.addEventListener("animationend",d)}}});
//# sourceMappingURL=dictationchat.min.js.map
