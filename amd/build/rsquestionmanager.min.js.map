{"version":3,"sources":["../src/rsquestionmanager.js"],"names":["define","$","jqui","log","templates","def","mfh","mdh","mih","datatables","debug","cmid","controls","init","props","dd","contextid","tableid","register_events","process_html","questionstable","getDataTable","questionscontainer","mod_poodlltime_items_cont","noquestionscontainer","mod_poodlltime_noitems_cont","movearrows","movearrow","moveRow","row","direction","console","index","order","data1","data","data2","page","draw","qtypes","qtype_dictation","qtype_dictationchat","qtype_page","qtype_speechcards","qtype_listenrepeat","qtype_multichoice","component","after_questionadd","item","itemid","id","typelabel","type","render","then","html","add","hide","show","itemrow","after_questionedit","therow","cell","name","after_questiondelete","remove","itemcount","rows","count","after_questionmove","targetindex","targetrow","eq","from","column","to"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery','jqueryui', 'core/log','core/templates','mod_poodlltime/definitions','mod_poodlltime/modalformhelper',\n        'mod_poodlltime/modaldeletehelper','mod_poodlltime/moveitemhelper','mod_poodlltime/datatables'],\n    function($, jqui, log, templates, def, mfh, mdh, mih, datatables) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('RSQuestion manager: initialising');\n\n    return {\n\n        cmid: null,\n        controls: null,\n\n\n        //pass in config\n        init: function(props){\n            var dd = this;\n            dd.contextid=props.contextid;\n            dd.tableid = props.tableid;\n\n            dd.register_events();\n            dd.process_html();\n        },\n\n        process_html: function(){\n            this.controls = [];\n            this.controls.questionstable = datatables.getDataTable(this.tableid);\n            this.controls.questionscontainer = $('#' + def.mod_poodlltime_items_cont);\n            this.controls.noquestionscontainer = $('#' + def.mod_poodlltime_noitems_cont);\n            this.controls.movearrows=$('#' + def.movearrow);\n        },\n        moveRow:function(row, direction) {\n            console.log(\"moved\");\n          \n            var index = this.controls.questionstable.row(row).index();\n            \n            console.log(index);\n          \n            var order = -1;\n            if (direction === 'down') {\n              order = 1;\n            }\n\n            console.log(order);\n          \n            var data1 = this.controls.questionstable.row(index).data();\n            data1.order += order;\n          \n            console.log(data1);\n\n            var data2 = this.controls.questionstable.row(index + order).data();\n            data2.order += -order;\n          \n            console.log(data2);\n\n            this.controls.questionstable.row(index).data(data2);\n            this.controls.questionstable.row(index + order).data(data1);\n\n            this.controls.questionstable.page(0).draw(false);\n            \n        },\n        register_events: function() {\n          \n            var dd = this;\n          \n            var qtypes =[def.qtype_dictation,def.qtype_dictationchat,def.qtype_page,\n                def.qtype_speechcards,def.qtype_listenrepeat, def.qtype_multichoice];\n\n            var after_questionmove= function(itemid, direction) {\n              \n                var therow = '#' + def.itemrow + '_' + itemid;\n                var index = dd.controls.questionstable.row(therow).index();\n              \n                var targetindex;\n              \n                if(direction==\"up\"){\n                  targetindex=index-1;\n                } else if(direction==\"down\"){\n                  targetindex=index+1;\n                }\n                \n                var targetrow=$(\".mod_poodlltime_item_row\").eq(targetindex);\n              \n                var from = dd.controls.questionstable.cell({row:index, column:0}).data();\n                var to = dd.controls.questionstable.cell({row:targetindex, column:0}).data();\n                dd.controls.questionstable.cell({row:index, column:0}).data(to);\n                dd.controls.questionstable.cell({row:targetindex, column:0}).data(from);\n\n                dd.controls.questionstable.draw();\n            };\n\n            var after_questionedit= function(item, itemid) {\n                var therow = '#' + def.itemrow + '_' + itemid;\n                dd.controls.questionstable.cell($(therow + ' .c1')).data(item.name);\n            };\n            var after_questionadd= function(item, itemid) {\n                item.id = itemid;\n                item.typelabel = item.type;\n                templates.render('mod_poodlltime/itemlistitem',item).then(\n                    function(html,js){\n                        dd.controls.questionstable.row.add($(html)[0]).draw();\n                    }\n                );\n                dd.controls.noquestionscontainer.hide();\n                dd.controls.questionscontainer.show();\n            };\n            var after_questiondelete= function(itemid) {\n                log.debug('after question delete');\n                dd.controls.questionstable.row('#' + def.itemrow + '_' + itemid).remove().draw();\n                var itemcount = dd.controls.questionstable.rows().count();\n                if(!itemcount){\n                    dd.controls.noquestionscontainer.show();\n                    dd.controls.questionscontainer.hide();\n                }\n            };\n\n            //register ajax modal handler\n            var editcallback=function(item, itemid){console.log(item);};\n            var deletecallback=function(itemid){console.log(itemid);};\n            var addcallback=function(itemid){console.log(itemid);};\n            mfh.init('.' + def.component + '_addlink', dd.contextid,after_questionadd);\n            //edit form helper\n            mfh.init('.' + def.itemrow + '_editlink', dd.contextid,after_questionedit);\n            //delete helpser\n            mdh.init('.' + def.itemrow + '_deletelink', dd.contextid, 'deleteitem',after_questiondelete);\n            //move helper\n            mih.init('.' + def.movearrow , dd.contextid, after_questionmove);\n        }\n\n    };//end of returned object\n});//total end\n"],"file":"rsquestionmanager.min.js"}