define ("mod_poodlltime/quizhelper",["jquery","core/log","mod_poodlltime/definitions","core/templates","core/ajax","mod_poodlltime/pollyhelper","mod_poodlltime/dictation","mod_poodlltime/dictationchat","mod_poodlltime/multichoice","mod_poodlltime/speechcards","mod_poodlltime/listenrepeat","mod_poodlltime/page"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";b.debug("Poodll Time Quiz helper: initialising");return{mobile_user:function mobile_user(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){return!0}else{return!1}},controls:{},submitbuttonclass:"mod_poodlltime_quizsubmitbutton",stepresults:[],init:function init(a,b,c,d){this.quizdata=b;this.controls.quizcontainer=a;this.attemptid=d;this.cmid=c;this.prepare_html();this.init_questions(b);this.register_events();this.start_quiz()},prepare_html:function prepare_html(){this.controls.quizfinished=a("#mod_poodlltime_quiz_finished")},init_questions:function init_questions(b,d){var e=this;a.each(b,function(a,b){switch(b.type){case c.qtype_dictation:g.init(a,b,e,d);break;case c.qtype_dictationchat:h.init(a,b,e,d);break;case c.qtype_multichoice:i.init(a,b,e);break;case c.qtype_speechcards:break;case c.qtype_listenrepeat:k.init(a,b,e);break;case c.qtype_page:l.init(a,b,e);break;}})},register_events:function register_events(){a("."+this.submitbuttonclass).on("click",function(){})},render_quiz_progress:function render_quiz_progress(b,c){for(var d="<ol class='ProgressBar'>",e=0;e<c;e++){d+="\n          <li class=\"ProgressBar-step\">\n            <svg class=\"ProgressBar-icon\"><use xlink:href=\"#checkmark-bold\"/></svg>\n            <span class=\"ProgressBar-stepLabel\">Cheese</span>\n          </li>"}d+="</ol>";a(".poodlltime_quiz_progress").find(".ProgressBarWrapper").html(d)},do_next:function do_next(b){var e=this;this.report_step_grade(b);var f=this.quizdata[b.index];a("#"+f.uniqueid+"_container").hide();if(this.quizdata.length>b.index+1){var g=b.index+1,h=this.quizdata[g];a("#"+h.uniqueid+"_container").show();switch(h.type){case c.qtype_speechcards:j.init(g,h,e);break;case c.qtype_dictation:case c.qtype_dictationchat:case c.qtype_multichoice:case c.qtype_listenrepeat:default:}}else{var i=e.stepresults.filter(function(a){return a.hasgrade}),k=0,l=0;i.forEach(function(a,b){a.index=b+1;a.title=e.quizdata[b].title;k+=a.correctitems;l+=a.totalitems});var m=Math.round(100*(k/l));console.log(i,k,l,m);d.render("mod_poodlltime/quizfinished",{results:i,total:m}).then(function(a){e.controls.quizfinished.html(a);e.controls.quizfinished.show()})}this.render_quiz_progress(b.index+1,this.quizdata.length)},report_step_grade:function report_step_grade(a){var b=this;this.stepresults.push(a);e.call([{methodname:"mod_poodlltime_report_step_grade",args:{cmid:b.cmid,step:a.index,grade:a.grade}}])},start_quiz:function start_quiz(){a("#"+this.quizdata[0].uniqueid+"_container").show();this.render_quiz_progress(0,this.quizdata.length)},onSubmit:function onSubmit(){alert("quiz submitted. Override this")}}});
//# sourceMappingURL=quizhelper.min.js.map
