define(["jquery","core/log","mod_poodlltime/definitions","core/templates","core/ajax","mod_poodlltime/pollyhelper","mod_poodlltime/dictation","mod_poodlltime/dictationchat","mod_poodlltime/multichoice","mod_poodlltime/speechcards","mod_poodlltime/listenrepeat","mod_poodlltime/page"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";return b.debug("Poodll Time Quiz helper: initialising"),{mobile_user:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},controls:{},submitbuttonclass:"mod_poodlltime_quizsubmitbutton",stepresults:[],init:function(a,b,c,d){this.quizdata=b,this.controls.quizcontainer=a,this.attemptid=d,this.cmid=c,this.prepare_html(),this.init_questions(b),this.register_events(),this.start_quiz()},prepare_html:function(){this.controls.quizfinished=a("#mod_poodlltime_quiz_finished")},init_questions:function(b,d){var e=this;a.each(b,function(a,b){switch(b.type){case c.qtype_dictation:g.init(a,b,e,d);break;case c.qtype_dictationchat:h.init(a,b,e,d);break;case c.qtype_multichoice:i.init(a,b,e);break;case c.qtype_speechcards:j.init(a,b,e);break;case c.qtype_listenrepeat:k.init(a,b,e);break;case c.qtype_page:l.init(a,b,e)}})},register_events:function(){a("."+this.submitbuttonclass).on("click",function(){})},render_quiz_progress:function(b,c){for(var d=[],e=0;e<c;e++)d.push(e);var f=d.slice(b,b+5),g="<div class='poodlltime_quiz_progress_line'></div>";f.forEach(function(a){g+="<div class='poodlltime_quiz_progress_item "+(a==b?"poodlltime_quiz_progress_item_current":"")+" "+(a<b?"poodlltime_quiz_progress_item_completed":"")+"'>"+(a+1)+"</div>"}),g+="",a(".poodlltime_quiz_progress").html(g)},do_next:function(b){var e=this;this.report_step_grade(b);var f=this.quizdata[b.index];if(a("#"+f.uniqueid+"_container").hide(),this.quizdata.length>b.index+1){var g=b.index+1,h=this.quizdata[g];switch(a("#"+h.uniqueid+"_container").show(),h.type){case c.qtype_speechcards:break;case c.qtype_dictation:case c.qtype_dictationchat:case c.qtype_multichoice:case c.qtype_listenrepeat:}}else{var i=e.stepresults.filter(function(a){return a.hasgrade}),j=0,k=0;i.forEach(function(a,b){a.index=b+1,a.title=e.quizdata[b].title,j+=a.correctitems,k+=a.totalitems});var l=Math.round(j/k*100);console.log(i,j,k,l),d.render("mod_poodlltime/quizfinished",{results:i,total:l}).then(function(a,b){e.controls.quizfinished.html(a),e.controls.quizfinished.show()})}this.render_quiz_progress(b.index+1,this.quizdata.length)},report_step_grade:function(a){var b=this;this.stepresults.push(a),e.call([{methodname:"mod_poodlltime_report_step_grade",args:{cmid:b.cmid,step:a.index,grade:a.grade}}])},start_quiz:function(){a("#"+this.quizdata[0].uniqueid+"_container").show(),this.render_quiz_progress(0,this.quizdata.length)},onSubmit:function(){alert("quiz submitted. Override this")}}});