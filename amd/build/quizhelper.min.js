define ("mod_poodlltime/quizhelper",["jquery","core/log","mod_poodlltime/definitions","core/templates"],function(a,b,c,d){"use strict";b.debug("Poodll Time Quiz helper: initialising");return{controls:{},submitbuttonclass:"mod_poodlltime_quizsubmitbutton",init:function init(a,b,c,d,e){this.quizdata=b;this.controls.quizcontainer=a;this.attemptid=d;this.passagepictureurl=e;this.cmid=c;this.prepare_html();this.register_events()},prepare_html:function prepare_html(){var b=this,e="<span>A: @@DATA@@</span><br>",f="<button type=\"button\" class=\""+this.submitbuttonclass+"\">Submit Quiz</button><br>",g="<span><img src=\""+this.passagepictureurl+"\"></img></span><br>";b.controls.quizcontainer.append(g);a.each(this.quizdata,function(a,f){var g="<span><b>QUESTION @@INDEX@@: @@DATA@@</b></span><br>".replace("@@DATA@@",f.text);g=g.replace("@@INDEX@@",a+1);b.controls.quizcontainer.append(g);switch(f.type){case c.qtype_textpromptaudio:b.controls.quizcontainer.append("<span><i>A: [ AUDIO RECORDER GOES HERE ] </i></span><br>");break;case c.qtype_textpromptlong:break;case c.qtype_dictationchat:d.render("mod_poodlltime/dictationchat",f).then(function(a,c){d.appendNodeContents(b.controls.quizcontainer,a,c)}).fail(function(){});break;case c.qtype_dictation:f.sentences=f.customtext1.split(/\n/);d.render("mod_poodlltime/dictation",f).then(function(a,c){d.appendNodeContents(b.controls.quizcontainer,a,c)}).fail(function(){});break;case c.qtype_textpromptshort:break;default:b.controls.quizcontainer.append(e.replace("@@DATA@@",f.customtext1));b.controls.quizcontainer.append(e.replace("@@DATA@@",f.customtext2));b.controls.quizcontainer.append(e.replace("@@DATA@@",f.customtext3));b.controls.quizcontainer.append(e.replace("@@DATA@@",f.customtext4));}});b.controls.quizcontainer.append(f)},register_events:function register_events(){var b=this;a("."+this.submitbuttonclass).on("click",function(){b.send_quizresults({qanswer1:"1",qanswer2:"2",qanswer3:"3",qanswer4:"4",qanswer5:"1",qtextanswer1:"abc"})})},send_quizresults:function send_quizresults(c){var d={action:"quizresults",attemptid:this.attemptid,cmid:this.cmid,quizresults:JSON.stringify(c)},e=new XMLHttpRequest,f=this;e.onreadystatechange=function(){if(4===this.readyState){if(200==e.status){b.debug("ok we got an attempt quiz submission response")}else{b.debug("NOT GOOD attempt quiz submission  response")}var a=e.responseText,c=JSON.parse(a);if(c){f.onSubmit(c)}else{f.onSubmit(!1)}}};e.open("POST",M.cfg.wwwroot+"/mod/poodlltime/ajaxhelper.php",!0);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.setRequestHeader("Cache-Control","no-cache");e.send(a.param(d))},onSubmit:function onSubmit(){alert("quiz submitted. Override this")}}});
//# sourceMappingURL=quizhelper.min.js.map
