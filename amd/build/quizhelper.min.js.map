{"version":3,"sources":["../src/quizhelper.js"],"names":["define","$","log","def","templates","Ajax","polly","dictation","dictationchat","multichoice","speechcards","listenrepeat","page","debug","mobile_user","test","navigator","userAgent","controls","submitbuttonclass","stepresults","init","quizcontainer","quizdata","cmid","attemptid","prepare_html","init_questions","register_events","start_quiz","quizfinished","dd","each","index","item","type","qtype_dictation","qtype_dictationchat","qtype_multichoice","qtype_speechcards","qtype_listenrepeat","qtype_page","on","render_quiz_progress","current","total","array","i","push","slice","html","forEach","do_next","stepdata","report_step_grade","currentitem","uniqueid","hide","length","nextindex","nextitem","show","results","filter","e","hasgrade","correctitems","totalitems","result","title","totalpercent","Math","round","console","render","then","call","methodname","args","step","grade","onSubmit","alert"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_poodlltime/definitions', 'core/templates', 'core/ajax', 'mod_poodlltime/pollyhelper',\n    'mod_poodlltime/dictation', 'mod_poodlltime/dictationchat', 'mod_poodlltime/multichoice', 'mod_poodlltime/speechcards', 'mod_poodlltime/listenrepeat','mod_poodlltime/page'\n  ],\n  function($, log, def, templates, Ajax, polly, dictation, dictationchat, multichoice, speechcards, listenrepeat, page) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('Poodll Time Quiz helper: initialising');\n\n    return {\n      \n      mobile_user: function() {\n\n        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n          return true;\n        } else {\n          return false;\n        }\n\n      },\n\n      controls: {},\n      submitbuttonclass: 'mod_poodlltime_quizsubmitbutton',\n      stepresults: [],\n\n      init: function(quizcontainer, quizdata, cmid, attemptid) {\n        this.quizdata = quizdata;\n        this.controls.quizcontainer = quizcontainer;\n        this.attemptid = attemptid;\n        this.cmid = cmid;\n        this.prepare_html();\n        this.init_questions(quizdata);\n        this.register_events();\n        this.start_quiz();\n      },\n\n      prepare_html: function() {\n\n        // this.controls.quizcontainer.append(submitbutton);\n        this.controls.quizfinished=$(\"#mod_poodlltime_quiz_finished\");\n\n      },\n\n      init_questions: function(quizdata, polly) {\n        var dd = this;\n        $.each(quizdata, function(index, item) {\n          switch (item.type) {\n            case def.qtype_dictation:\n              dictation.init(index, item, dd, polly);\n              break;\n            case def.qtype_dictationchat:\n              dictationchat.init(index, item, dd, polly);\n              break;\n            case def.qtype_multichoice:\n              multichoice.init(index, item, dd);\n              break;\n              case def.qtype_speechcards:\n              //speechcards init needs to occur when it is visible. lame.\n              // so we do that in do_next function, down below\n              speechcards.init(index, item, dd);\n              break;\n            case def.qtype_listenrepeat:\n              listenrepeat.init(index, item, dd);\n              break;\n\n             case def.qtype_page:\n                  page.init(index, item, dd);\n                  break;\n          }\n\n        });\n\n      },\n\n      register_events: function() {\n        $('.' + this.submitbuttonclass).on('click', function() {\n          //do something\n        });\n      },\n      render_quiz_progress:function(current,total){\n        var array = [];\n        for(var i=0;i<total;i++){\n          array.push(i);\n        }\n        var slice = array.slice(current,current+5);\n        var html = \"<div class='poodlltime_quiz_progress_line'></div>\";\n        slice.forEach(function(i){\n          html+=\"<div class='poodlltime_quiz_progress_item \"+(i==current?'poodlltime_quiz_progress_item_current':'')+\" \"+(i<current?'poodlltime_quiz_progress_item_completed':'')+\"'>\"+(i+1)+\"</div>\";\n        });\n        html+=\"\";\n        $(\".poodlltime_quiz_progress\").html(html);\n      },\n\n      do_next: function(stepdata){\n        var dd = this;\n        this.report_step_grade(stepdata);\n        //hide current question\n        var currentitem = this.quizdata[stepdata.index];\n        $(\"#\" + currentitem.uniqueid + \"_container\").hide();\n        //show next question or End Screen\n        if (this.quizdata.length > stepdata.index + 1) {\n          var nextindex = stepdata.index + 1;\n          var nextitem = this.quizdata[nextindex];\n            //show the question\n            $(\"#\" + nextitem.uniqueid + \"_container\").show();\n          //any per question type init that needs to occur can go here\n          switch (nextitem.type) {\n              case def.qtype_speechcards:\n                  //speechcards.init(nextindex, nextitem, dd);\n                  break;\n              case def.qtype_dictation:\n              case def.qtype_dictationchat:\n              case def.qtype_multichoice:\n              case def.qtype_listenrepeat:\n              default:\n          }//end of nextitem switch\n\n        } else {\n\n          var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n          var correctitems = 0;\n          var totalitems = 0;\n          results.forEach(function(result,i){\n            result.index=i+1;\n            result.title=dd.quizdata[i].title;\n            correctitems += result.correctitems;\n            totalitems += result.totalitems;\n          })\n          var totalpercent = Math.round((correctitems/totalitems)*100);\n          console.log(results,correctitems,totalitems,totalpercent);\n          templates.render('mod_poodlltime/quizfinished',{results:results,total:totalpercent}).then(\n              function(html,js){\n                  dd.controls.quizfinished.html(html);\n                  dd.controls.quizfinished.show();\n              }\n          );\n\n        }\n        \n        this.render_quiz_progress(stepdata.index+1,this.quizdata.length);\n        \n      },\n\n      report_step_grade: function(stepdata) {\n        var dd = this;\n        //store results locally\n        this.stepresults.push(stepdata);\n\n        //push results to server\n        Ajax.call([{\n          methodname: 'mod_poodlltime_report_step_grade',\n          args: {\n            cmid: dd.cmid,\n            step: stepdata.index,\n            grade: stepdata.grade\n          }\n        }]);\n      },\n\n      start_quiz: function() {\n        $(\"#\" + this.quizdata[0].uniqueid + \"_container\").show();\n        this.render_quiz_progress(0,this.quizdata.length);\n      },\n\n      //this function is overridden by the calling class\n      onSubmit: function() {\n        alert('quiz submitted. Override this');\n      },\n\n    }; //end of return value\n  });"],"file":"quizhelper.min.js"}