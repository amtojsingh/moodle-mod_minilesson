{"version":3,"sources":["../src/quizhelper.js"],"names":["define","$","log","def","templates","Ajax","polly","dictation","dictationchat","multichoice","speechcards","listenrepeat","page","teachertools","shortanswer","debug","controls","submitbuttonclass","stepresults","init","quizcontainer","activitydata","cmid","attemptid","quizdata","region","ttslanguage","courseurl","prepare_html","init_questions","register_events","start_quiz","quizfinished","dd","each","index","item","type","qtype_dictation","clone","qtype_dictationchat","qtype_multichoice","qtype_speechcards","qtype_listenrepeat","qtype_page","qtype_teachertools","qtype_shortanswer","on","render_quiz_progress","current","total","array","i","push","slice","html","forEach","do_next","stepdata","currentquizdataindex","currentitem","preview","report_step_grade","uniqueid","hide","length","nextitem","show","results","filter","e","hasgrade","correctitems","totalitems","result","title","totalpercent","Math","round","console","render","then","call","methodname","args","step","JSON","stringify","onSubmit","alert","mobile_user","test","navigator","userAgent","chrome_user","use_ttrecorder","ret","language","substr"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_poodlltime/definitions', 'core/templates', 'core/ajax', 'mod_poodlltime/pollyhelper',\n    'mod_poodlltime/dictation', 'mod_poodlltime/dictationchat', 'mod_poodlltime/multichoice', 'mod_poodlltime/speechcards', 'mod_poodlltime/listenrepeat',\n        'mod_poodlltime/page','mod_poodlltime/teachertools','mod_poodlltime/shortanswer'],\n  function($, log, def, templates, Ajax, polly, dictation, dictationchat, multichoice, speechcards, listenrepeat, page, teachertools, shortanswer) {\n    \"use strict\"; // jshint ;_;\n\n    /*\n    This file is to manage the quiz stage\n     */\n\n    log.debug('Poodll Time Quiz helper: initialising');\n\n    return {\n      \n\n      controls: {},\n      submitbuttonclass: 'mod_poodlltime_quizsubmitbutton',\n      stepresults: [],\n\n      init: function(quizcontainer, activitydata, cmid, attemptid) {\n        this.quizdata = activitydata.quizdata;\n        this.region = activitydata.region;\n        this.ttslanguage = activitydata.ttslanguage;\n        this.controls.quizcontainer = quizcontainer;\n        this.attemptid = attemptid;\n        this.courseurl = activitydata.courseurl;\n        this.cmid = cmid;\n        this.prepare_html();\n        this.init_questions(this.quizdata);\n        this.register_events();\n        this.start_quiz();\n      },\n\n      prepare_html: function() {\n\n        // this.controls.quizcontainer.append(submitbutton);\n        this.controls.quizfinished=$(\"#mod_poodlltime_quiz_finished\");\n\n      },\n\n      init_questions: function(quizdata, polly) {\n        var dd = this;\n        $.each(quizdata, function(index, item) {\n          switch (item.type) {\n            case def.qtype_dictation:\n              dictation.clone().init(index, item, dd, polly);\n              break;\n            case def.qtype_dictationchat:\n              dictationchat.clone().init(index, item, dd, polly);\n              break;\n            case def.qtype_multichoice:\n              multichoice.clone().init(index, item, dd);\n              break;\n              case def.qtype_speechcards:\n              //speechcards init needs to occur when it is visible. lame.\n              // so we do that in do_next function, down below\n              speechcards.clone().init(index, item, dd);\n              break;\n            case def.qtype_listenrepeat:\n              listenrepeat.clone().init(index, item, dd);\n              break;\n\n             case def.qtype_page:\n                  page.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_teachertools:\n                  teachertools.clone().init(index, item, dd);\n                  break;\n\n              case def.qtype_shortanswer:\n                  shortanswer.clone().init(index, item, dd);\n                  break;\n          }\n\n        });\n\n      },\n\n      register_events: function() {\n        $('.' + this.submitbuttonclass).on('click', function() {\n          //do something\n        });\n      },\n      render_quiz_progress:function(current,total){\n        var array = [];\n        for(var i=0;i<total;i++){\n          array.push(i);\n        }\n        if(total<6 || current > total -6 ) {\n            var slice = array.slice(current, current + 5);\n            var html = \"<div class='poodlltime_quiz_progress_line'></div>\";\n            slice.forEach(function (i) {\n                html += \"<div class='poodlltime_quiz_progress_item \" + (i == current ? 'poodlltime_quiz_progress_item_current' : '') + \" \" + (i < current ? 'poodlltime_quiz_progress_item_completed' : '') + \"'>\" + (i + 1) + \"</div>\";\n            });\n        }else {\n              var slice = array.slice(current, current + 4);\n              var html = \"<div class='poodlltime_quiz_progress_line'></div>\";\n              slice.forEach(function (i) {\n                  html += \"<div class='poodlltime_quiz_progress_item \" + (i == current ? 'poodlltime_quiz_progress_item_current' : '') + \" \" + (i < current ? 'poodlltime_quiz_progress_item_completed' : '') + \"'>\" + (i + 1) + \"</div>\";\n              });\n              //end marker\n            html += \"<div class='poodlltime_quiz_progress_finalitem'>\" + (total) + \"</div>\";\n          }\n\n        html+=\"\";\n        $(\".poodlltime_quiz_progress\").html(html);\n\n      },\n\n      do_next: function(stepdata){\n        var dd = this;\n        //get current question\n        var currentquizdataindex =   stepdata.index;\n        var currentitem = this.quizdata[currentquizdataindex];\n\n        //in preview mode do no do_next\n        if(currentitem.preview===true){return;}\n\n        //post grade\n        dd.report_step_grade(stepdata);\n        //hide current question\n        $(\"#\" + currentitem.uniqueid + \"_container\").hide();\n        //show next question or End Screen\n        if (dd.quizdata.length > currentquizdataindex+1) {\n          var nextindex = currentquizdataindex+ 1;\n          var nextitem = this.quizdata[nextindex];\n            //show the question\n            $(\"#\" + nextitem.uniqueid + \"_container\").show();\n          //any per question type init that needs to occur can go here\n          switch (nextitem.type) {\n              case def.qtype_speechcards:\n                  //speechcards.init(nextindex, nextitem, dd);\n                  break;\n              case def.qtype_dictation:\n              case def.qtype_dictationchat:\n              case def.qtype_multichoice:\n              case def.qtype_listenrepeat:\n              case def.qtype_teachertools:\n              case def.qtype_shortanswer:\n              default:\n          }//end of nextitem switch\n\n        } else {\n\n          var results = dd.stepresults.filter(function(e){return e.hasgrade;});\n          var correctitems = 0;\n          var totalitems = 0;\n          results.forEach(function(result,i){\n            result.index=i+1;\n            result.title=dd.quizdata[i].title;\n            correctitems += result.correctitems;\n            totalitems += result.totalitems;\n          });\n          var totalpercent = Math.round((correctitems/totalitems)*100);\n          console.log(results,correctitems,totalitems,totalpercent);\n          templates.render('mod_poodlltime/quizfinished',{results:results,total:totalpercent, courseurl: this.courseurl}).then(\n              function(html,js){\n                  dd.controls.quizfinished.html(html);\n                  dd.controls.quizfinished.show();\n              }\n          );\n\n        }\n        \n        this.render_quiz_progress(stepdata.index+1,this.quizdata.length);\n        \n      },\n\n      report_step_grade: function(stepdata) {\n        var dd = this;\n\n        //store results locally\n        this.stepresults.push(stepdata);\n\n        //push results to server\n        Ajax.call([{\n          methodname: 'mod_poodlltime_report_step_grade',\n          args: {\n            cmid: dd.cmid,\n            step: JSON.stringify(stepdata),\n          }\n        }]);\n      },\n\n\n\n      start_quiz: function() {\n        $(\"#\" + this.quizdata[0].uniqueid + \"_container\").show();\n        this.render_quiz_progress(0,this.quizdata.length);\n      },\n\n      //this function is overridden by the calling class\n      onSubmit: function() {\n        alert('quiz submitted. Override this');\n      },\n\n        mobile_user: function() {\n\n            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {\n                return true;\n            } else {\n                return false;\n            }\n        },\n\n        chrome_user: function(){\n            if(/Chrome/i.test(navigator.userAgent)) {\n                return true;\n            }else{\n                return false;\n            }\n        },\n\n        use_ttrecorder: function(){\n            var ret =false;\n            if(this.mobile_user()){\n                ret = true;\n            }else if(this.chrome_user()){\n                ret = false;\n            }else{\n                ret = true;\n            }\n            if(ret===false){return false;}\n\n            //check if language and region are ok\n            switch(this.region){\n                case 'tokyo':\n                case 'useast1':\n                case 'dublin':\n                case 'sydney':\n                    ret = this.language.substr(0,2)==='en';\n                    break;\n                default:\n                    ret = false;\n            }\n            return ret;\n        },\n\n\n    }; //end of return value\n  });"],"file":"quizhelper.min.js"}