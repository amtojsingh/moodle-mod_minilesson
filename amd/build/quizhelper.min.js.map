{"version":3,"sources":["../src/quizhelper.js"],"names":["define","$","log","def","templates","debug","controls","submitbuttonclass","init","quizcontainer","quizdata","cmid","attemptid","passagepictureurl","prepare_html","register_events","dd","text_answer_template","submitbutton","passagepicture","append","each","index","item","question","replace","text","type","qtype_textpromptaudio","qtype_textpromptlong","qtype_dictationchat","render","then","html","js","appendNodeContents","fail","qtype_dictation","sentences","customtext1","split","qtype_textpromptshort","customtext2","customtext3","customtext4","on","send_quizresults","quizresults","params","action","JSON","stringify","xhr","XMLHttpRequest","that","onreadystatechange","readyState","status","payload","responseText","payloadobject","parse","onSubmit","open","M","cfg","wwwroot","setRequestHeader","send","param","alert"],"mappings":"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","sourcesContent":["define(['jquery', 'core/log', 'mod_poodlltime/definitions', 'core/templates'], function($, log, def, templates) {\n  \"use strict\"; // jshint ;_;\n\n  /*\n  This file is to manage the quiz stage\n   */\n\n  log.debug('Poodll Time Quiz helper: initialising');\n\n  return {\n\n    controls: {},\n    submitbuttonclass: 'mod_poodlltime_quizsubmitbutton',\n\n    init: function(quizcontainer, quizdata, cmid, attemptid, passagepictureurl) {\n      this.quizdata = quizdata;\n      this.controls.quizcontainer = quizcontainer;\n      this.attemptid = attemptid;\n      this.passagepictureurl = passagepictureurl;\n      this.cmid = cmid;\n      this.prepare_html();\n      this.register_events();\n    },\n\n    prepare_html: function() {\n      var dd = this;\n      var qtemplate = '<span><b>QUESTION @@INDEX@@: @@DATA@@</b></span><br>';\n      var text_answer_template = '<span>A: @@DATA@@</span><br>';\n      var audio_answer_template = '<span><i>A: [ AUDIO RECORDER GOES HERE ] </i></span><br>';\n      var submitbutton = '<button type=\"button\" class=\"' + this.submitbuttonclass + '\">Submit Quiz</button><br>';\n      var passagepicture = '<span><img src=\"' + this.passagepictureurl + '\"></img></span><br>';\n      //shoe passage picture\n      dd.controls.quizcontainer.append(passagepicture);\n\n      $.each(this.quizdata, function(index, item) {\n        var question = qtemplate.replace('@@DATA@@', item.text);\n        question = question.replace('@@INDEX@@', index + 1)\n        dd.controls.quizcontainer.append(question);\n\n        switch (item.type) {\n          case def.qtype_textpromptaudio:\n            dd.controls.quizcontainer.append(audio_answer_template);\n            break;\n          case def.qtype_textpromptlong:\n            break;\n          case def.qtype_dictationchat:\n            //display the dictation chat from template\n            // This will call the function to load and render our template.\n            templates.render('mod_poodlltime/dictationchat', item)\n\n              // It returns a promise that needs to be resoved.\n              .then(function(html, js) {\n                // Here eventually I have my compiled template, and any javascript that it generated.\n                // The templates object has append, prepend and replace functions.\n                templates.appendNodeContents(dd.controls.quizcontainer, html, js);\n              }).fail(function(ex) {\n                // Deal with this exception (I recommend core/notify exception function for this).\n              });\n            break;\n\n          case def.qtype_dictation:\n\n            item.sentences = item.customtext1.split(/\\n/);\n            templates.render('mod_poodlltime/dictation', item)\n\n              .then(function(html, js) {\n                \n                templates.appendNodeContents(dd.controls.quizcontainer, html, js);\n              \n              }).fail(function(ex) {\n\n              });\n            break;\n\n          case def.qtype_textpromptshort:\n            break;\n          default:\n            dd.controls.quizcontainer.append(text_answer_template.replace('@@DATA@@', item.customtext1));\n            dd.controls.quizcontainer.append(text_answer_template.replace('@@DATA@@', item.customtext2));\n            dd.controls.quizcontainer.append(text_answer_template.replace('@@DATA@@', item.customtext3));\n            dd.controls.quizcontainer.append(text_answer_template.replace('@@DATA@@', item.customtext4));\n        }\n      });\n\n\n\n      dd.controls.quizcontainer.append(submitbutton);\n\n\n    },\n\n    register_events: function() {\n      var dd = this;\n      $('.' + this.submitbuttonclass).on('click', function() {\n        var quizresults = {\n          \"qanswer1\": \"1\",\n          \"qanswer2\": \"2\",\n          \"qanswer3\": \"3\",\n          \"qanswer4\": \"4\",\n          \"qanswer5\": \"1\",\n          \"qtextanswer1\": \"abc\"\n        };\n        dd.send_quizresults(quizresults);\n      });\n    },\n\n    send_quizresults: function(quizresults) {\n      var params = {};\n      params.action = 'quizresults';\n      params.attemptid = this.attemptid;\n      params.cmid = this.cmid;\n      params.quizresults = JSON.stringify(quizresults);\n      //set up our ajax request\n      var xhr = new XMLHttpRequest();\n      var that = this;\n\n      //set up our handler for the response\n      xhr.onreadystatechange = function(e) {\n        if (this.readyState === 4) {\n          if (xhr.status == 200) {\n            log.debug('ok we got an attempt quiz submission response');\n          } else {\n            log.debug('NOT GOOD attempt quiz submission  response');\n          }\n          //let our parent class know about the submission\n          var payload = xhr.responseText;\n          var payloadobject = JSON.parse(payload);\n          if (payloadobject) {\n            that.onSubmit(payloadobject);\n          } else {\n            that.onSubmit(false);\n          }\n        }\n      };\n      //send it off\n      xhr.open(\"POST\", M.cfg.wwwroot + '/mod/poodlltime/ajaxhelper.php', true);\n      xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n      xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\n      xhr.send($.param(params));\n    },\n\n    //this function is overridden by the calling class\n    onSubmit: function() {\n      alert('quiz submitted. Override this');\n    },\n\n  }; //end of return value\n});"],"file":"quizhelper.min.js"}